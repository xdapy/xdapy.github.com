

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Usage &mdash; xdapy 0.9.0 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="xdapy 0.9.0 documentation" href="index.html" />
    <link rel="next" title="Database Format" href="tables.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>xdapy 0.9.0 documentation</span></a></h1>
        <h2 class="heading"><span>Usage</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="install.html">Installation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="tables.html">Database Format</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="opening-a-connection">
<h2>Opening a connection<a class="headerlink" href="#opening-a-connection" title="Permalink to this headline">¶</a></h2>
<p>In order to access a database, we need to create a mapper:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mapper</span> <span class="o">=</span> <span class="n">xdapy</span><span class="o">.</span><span class="n">Mapper</span><span class="p">(</span><span class="s">&quot;postgresql://user:pass@host/dbname&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>we may also connect to a SQLite database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sqlite_mapper</span> <span class="o">=</span> <span class="n">xdapy</span><span class="o">.</span><span class="n">Mapper</span><span class="p">(</span><span class="s">&quot;sqlite:///test.db&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>or even to a memory-based database for testing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">memory_mapper</span> <span class="o">=</span> <span class="n">xdapy</span><span class="o">.</span><span class="n">Mapper</span><span class="p">(</span><span class="s">&quot;sqlite://&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-model">
<h2>Creating a model<a class="headerlink" href="#creating-a-model" title="Permalink to this headline">¶</a></h2>
<p>We now need to define a structure which holds our data. For example, let’s assume we’d like to keep track of certain experiments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Experiment</span><span class="p">(</span><span class="n">xdapy</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
    <span class="n">declared_params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">&#39;ident&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
      <span class="s">&#39;project&#39;</span><span class="p">:</span> <span class="s">&#39;string&#39;</span><span class="p">,</span>
      <span class="s">&#39;supervisor&#39;</span><span class="p">:</span> <span class="s">&#39;string&#39;</span><span class="p">,</span>
      <span class="s">&#39;observer&#39;</span><span class="p">:</span> <span class="s">&#39;string&#39;</span><span class="p">,</span>
      <span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="s">&#39;date&#39;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>We have created a subclass of <tt class="xref py py-obj docutils literal"><span class="pre">xdapy.Entity</span></tt> and added a special structure <tt class="docutils literal"><span class="pre">declared_params</span></tt> to it. In <tt class="docutils literal"><span class="pre">declared_params</span></tt> we have to specify all the parameters we want to store for this <tt class="xref py py-obj docutils literal"><span class="pre">Entity</span></tt>. Also, we have to specify the type for the respective parameters. This is mainly needed for SQL storage but also provides us with a minimal type checking system.</p>
<p>The <tt class="docutils literal"><span class="pre">declared_params</span></tt> structure is evaluated during the creation of the class itself (read: metaclass) and automatically sets some more attributes on <tt class="xref py py-obj docutils literal"><span class="pre">Entity</span></tt>.</p>
<p>We can now try to instantiate and use our <tt class="xref py py-obj docutils literal"><span class="pre">Experiment</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s">&quot;The failed experiment project&quot;</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&quot;ident&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5005</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&quot;supervisor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;No name&quot;</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</pre></div>
</div>
<p>Parameters may be accessed and changed through the <tt class="docutils literal"><span class="pre">params</span></tt> dict. Additionally, for convenience, parameters may also be added inside the <tt class="docutils literal"><span class="pre">__init__</span></tt> method.</p>
<p>Using our mapper, we may also save it to the database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mapper</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="connecting-entities">
<h2>Connecting entities<a class="headerlink" href="#connecting-entities" title="Permalink to this headline">¶</a></h2>
<p>At some point, we may want to add metadata related to, say, the observer of a certain experiment. Maybe his or her age or some other attribute. Rather than adding this as a separate parameter to the experiment, one could consider creating another entity:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Observer</span><span class="p">(</span><span class="n">xdapy</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
    <span class="n">declared_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;string&#39;</span><span class="p">,</span>
        <span class="s">&#39;handedness&#39;</span><span class="p">:</span> <span class="s">&#39;string&#39;</span>
    <span class="p">}</span>

<span class="n">observer</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Unknown Observer&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then <em>connect</em> or <em>attach</em> this observer to all experiments:</p>
<div class="highlight-python"><pre>experiment.attach("Observer", observer)

// or, alternatively

experiment.context["Observer"].add(observer)</pre>
</div>
</div>
<div class="section" id="adding-data">
<h2>Adding data<a class="headerlink" href="#adding-data" title="Permalink to this headline">¶</a></h2>
<p>Adding binary data often needs special handling, since it potentially large data sets should not be automatically retrieved and loaded into memory from the database. Therefore, a special data API is integrated, acting on the <tt class="xref py py-obj docutils literal"><span class="pre">Entity.data</span></tt> property:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">experiment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;dataset #1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;dataset #2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">more_data</span><span class="p">)</span>
</pre></div>
</div>
<p><em>xdapy</em> takes care of splitting the data into smaller chunks which do not flood the memory and which are saved to the database right away. Consequently, the data should not be retrieved and loaded into memory but directly saved to a file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_to</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">experiment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;dataset #1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="install.html">Installation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="tables.html">Database Format</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, Hannah Dold, Rike-Benjamin Schuppner.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>